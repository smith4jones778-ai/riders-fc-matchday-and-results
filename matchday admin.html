<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Match Admin Panel</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
*{box-sizing:border-box;font-family:'Poppins',sans-serif}
body{margin:0;min-height:100vh;background:linear-gradient(135deg,#101820,#0b3d2e);color:#fff;display:flex;justify-content:center;align-items:center;padding:20px}
.panel{max-width:900px;width:100%;background:#000000aa;border-radius:24px;padding:32px;box-shadow:0 30px 80px rgba(0,0,0,.7)}
h1{text-align:center;font-size:2.4rem;font-weight:800;color:#00ffd5;margin-bottom:26px}
.section{margin-bottom:26px}
.section h2{font-size:1.2rem;margin-bottom:10px;color:#1aff8c}
.row{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:14px}
button{padding:14px;border:none;border-radius:14px;background:linear-gradient(135deg,#1aff8c,#00ffd5);font-weight:700;color:#003322;cursor:pointer}
button.danger{background:linear-gradient(135deg,#ff4d4d,#ff9900)}
.display{background:#00000066;border-radius:16px;padding:18px;text-align:center}
.big{font-size:2.6rem;font-weight:800}
.small{opacity:.8;font-size:.9rem}
</style>
</head>
<body>
<div class="panel">
  <h1>Match Admin Control</h1>

  <div class="section">
    <h2>Live Status</h2>
    <div class="display">
      <div id="clock" class="big">00:00</div>
      <div id="half" class="small">PRE</div>
      <div id="score" class="big">0 : 0</div>
    </div>
  </div>

  <div class="section">
    <h2>Score Control</h2>
    <div class="row">
      <button onclick="goal('home')">Home Goal +</button>
      <button onclick="goal('away')">Away Goal +</button>
      <button class="danger" onclick="resetScore()">Reset Score</button>
    </div>
  </div>

  <div class="section">
    <h2>Match Timer</h2>
    <div class="row">
      <button onclick="startHalf('1H')">Start 1st Half</button>
      <button onclick="pauseTimer()">Pause</button>
      <button onclick="startHalf('2H')">Start 2nd Half</button>
      <button class="danger" onclick="setFT()">Full Time</button>
      <button onclick="resetHalf('1H')">Reset 1H</button>
      <button onclick="resetHalf('2H')">Reset 2H</button>
    </div>
  </div>
</div>

<script>
const firebaseConfig={
  apiKey:"AIzaSyBK5UM0n8-GLvleW7l6B8Hi-_WuC64QA4U",
  authDomain:"scores-b25a7.firebaseapp.com",
  projectId:"scores-b25a7",
  databaseURL: "https://scores-b25a7-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const ref = db.ref('match/live');

ref.once('value').then(snapshot => {
  if(!snapshot.exists()){
    ref.set({
      home:0,
      away:0,
      half:'PRE',
      timerRunning:false,
      elapsed:0,
      startTime:null
    });
  }
});

let interval = null;

// ================= REALTIME LISTENER =================
ref.on('value', snapshot => {
  const d = snapshot.val();
  if(!d) return;
  document.getElementById('score').innerText = `${d.home} : ${d.away}`;
  document.getElementById('half').innerText = d.half;
  renderTimer(d);
});

// ================= ACTIONS =================
function goal(side){
  ref.child(side).transaction(val => (val||0)+1);
}
function resetScore(){
  ref.update({home:0, away:0});
}
function startHalf(half){
  const start = Date.now();
  ref.update({half, timerRunning:true, startTime:start});
}
function pauseTimer(){
  ref.once('value').then(snapshot=>{
    const d = snapshot.val();
    if(!d.timerRunning || !d.startTime) return;
    const elapsed = (d.elapsed||0) + Math.floor((Date.now() - d.startTime)/1000);
    ref.update({elapsed, timerRunning:false, startTime:null});
  });
}
function setFT(){
  ref.update({half:'FT', timerRunning:false, startTime:null});
}
// ===== RESET HALF TIMER =====
function resetHalf(half){
  ref.update({half, elapsed:0, timerRunning:false, startTime:null});
}

// ================= TIMER RENDER =================
function renderTimer(d){
  clearInterval(interval);
  if(d.timerRunning && d.startTime){
    interval = setInterval(()=>{
      const sec = (d.elapsed||0) + Math.floor((Date.now() - d.startTime)/1000);
      drawClock(sec);
    },1000);
  } else {
    drawClock(d.elapsed||0);
  }
}
function drawClock(sec){
  const m = String(Math.floor(sec/60)).padStart(2,'0');
  const s = String(sec%60).padStart(2,'0');
  document.getElementById('clock').innerText = `${m}:${s}`;
}
</script>
</body>
</html>
