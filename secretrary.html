<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Riders FC | Secretary Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --primary:#0b3d91;
  --bg:#f4f6f9;
  --card:#ffffff;
}

* { box-sizing:border-box; font-family:Arial, sans-serif; }

body {
  margin:0;
  background:var(--bg);
}

header {
  background:var(--primary);
  color:white;
  padding:1.2rem;
  text-align:center;
}

section {
  max-width:1100px;
  margin:auto;
  padding:1.5rem;
}

.card {
  background:var(--card);
  padding:1.3rem;
  border-radius:8px;
  margin-bottom:25px;
}

h2 { color:#0b3d91; }

label {
  font-weight:bold;
  display:block;
  margin-top:10px;
}

input, textarea {
  width:100%;
  padding:10px;
  margin-top:6px;
}

textarea { min-height:90px; }

button {
  margin-top:12px;
  padding:12px;
  background:var(--primary);
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
  width:100%;
}

.btn-secondary {
  background:#444;
}

.project-item {
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#eef2ff;
  padding:10px;
  border-radius:6px;
  margin-bottom:8px;
}

.project-item button {
  width:auto;
  padding:6px 10px;
  font-size:0.9rem;
}
</style>
</head>

<body>

<header>
  <h1>Secretary Dashboard</h1>
  <p>Riders FC – Board Governance Management</p>
</header>

<section>

  <!-- MINUTES -->
  <div class="card">
    <h2>Create / Edit Board Meeting Minutes</h2>

    <form id="minutesForm">
      <label>Meeting Month</label>
      <input type="month" id="meetingDate" required>

      <button type="button" class="btn-secondary" onclick="loadExistingMinutes()">
        Load Existing Minutes (If Any)
      </button>

      <button type="button" class="btn-secondary" onclick="loadSampleMinutes()">
        Load Sample Minutes Template
      </button>

      <label>Attendance</label>
      <textarea id="attendance" required></textarea>

      <label style="color:#b30000">Agenda (Very Important)</label>
      <textarea id="agenda" required></textarea>

      <label>Discussion</label>
      <textarea id="discussion" required></textarea>

      <label>Resolutions / Decisions</label>
      <textarea id="resolutions" required></textarea>

      <label>Action Items</label>
      <textarea id="actions" required></textarea>

      <button type="submit">Save / Update Minutes</button>
    </form>
  </div>

  <!-- ADD PROJECT -->
  <div class="card">
    <h2>Add Upcoming Project</h2>
    <input type="text" id="newProject" placeholder="Project title">
    <button onclick="addProject()">Add Project</button>
  </div>

  <!-- MANAGE PROJECTS -->
  <div class="card">
    <h2>Manage Projects</h2>
    <h3>Upcoming Projects</h3>
    <div id="upcomingList"></div>
  </div>

</section>

<!-- FIREBASE + LOGIC -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, get, push, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB-BUuIs7VCzeZgGXziqsAk-zr7UarRp4c",
  authDomain: "survey-d97e7.firebaseapp.com",
  databaseURL: "https://survey-d97e7-default-rtdb.firebaseio.com",
  projectId: "survey-d97e7",
  storageBucket: "survey-d97e7.firebasestorage.app",
  messagingSenderId: "861361956801",
  appId: "1:861361956801:web:65b2ee8eb04f5c2d5d3140",
  measurementId: "G-QW860EGGZ9"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* SAVE / UPDATE MINUTES */
minutesForm.addEventListener("submit", e => {
  e.preventDefault();
  const date = meetingDate.value;

  const html = `
    <h2>Riders FC Board Meeting – ${date}</h2>
    <hr>
    <h3>Attendance</h3><p>${attendance.value}</p>
    <h3>Agenda</h3><p>${agenda.value}</p>
    <h3>Discussion</h3><p>${discussion.value}</p>
    <h3>Resolutions</h3><p>${resolutions.value}</p>
    <h3>Action Items</h3><p>${actions.value}</p>
  `;

  set(ref(db, "minutes/" + date), { html });
  alert("Minutes saved / updated successfully.");
});

/* LOAD EXISTING MINUTES */
window.loadExistingMinutes = () => {
  if (!meetingDate.value) return alert("Select a meeting month first");

  get(ref(db, "minutes/" + meetingDate.value)).then(snap => {
    if (!snap.exists()) {
      alert("No minutes found for this month.");
      return;
    }

    const doc = new DOMParser().parseFromString(snap.val().html, "text/html");
    attendance.value = doc.querySelector("h3:nth-of-type(1)+p")?.innerText || "";
    agenda.value = doc.querySelector("h3:nth-of-type(2)+p")?.innerText || "";
    discussion.value = doc.querySelector("h3:nth-of-type(3)+p")?.innerText || "";
    resolutions.value = doc.querySelector("h3:nth-of-type(4)+p")?.innerText || "";
    actions.value = doc.querySelector("h3:nth-of-type(5)+p")?.innerText || "";
  });
};

/* SAMPLE MINUTES TEMPLATE */
window.loadSampleMinutes = () => {
  attendance.value = "Chairman, Vice Chairman, Secretary, Treasurer, Directors";
  agenda.value = `
1. Opening Prayer
2. Adoption of Previous Minutes
3. Matters Arising
4. Club Operations Update
5. Financial Report
6. Projects & Development
7. Any Other Business
8. Closing
  `.trim();

  discussion.value = "Detailed discussions were held on each agenda item.";
  resolutions.value = "Resolutions were unanimously adopted on presented matters.";
  actions.value = "Secretary to circulate minutes. Treasurer to submit budget report.";
};

/* PROJECTS */
window.addProject = () => {
  const title = newProject.value.trim();
  if (!title) return alert("Enter project title");
  push(ref(db, "projects/upcoming"), { title });
  newProject.value = "";
  loadProjects();
};

const upcomingList = document.getElementById("upcomingList");

function loadProjects() {
  upcomingList.innerHTML = "";
  get(ref(db, "projects/upcoming")).then(snap => {
    if (!snap.exists()) {
      upcomingList.innerHTML = "<p>No upcoming projects.</p>";
      return;
    }

    snap.forEach(child => {
      const div = document.createElement("div");
      div.className = "project-item";
      div.innerHTML = `
        <span>${child.val().title}</span>
        <button onclick="finishProject('${child.key}','${child.val().title}')">
          Mark Finished
        </button>
      `;
      upcomingList.appendChild(div);
    });
  });
}

window.finishProject = (id, title) => {
  set(ref(db, "projects/finished/" + id), { title });
  remove(ref(db, "projects/upcoming/" + id));
  loadProjects();
};

loadProjects();
</script>

</body>
</html>
